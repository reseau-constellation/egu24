import{l as pe,d as ce,g as Oe,f as Le,r as ve,o as Se,m as Be,q as Ce,s as Te,u as Ne,T as Ae,v as De,w as _e}from"./index-MOnPZBRV.js";import{a as Re}from"./os-Qzk56i8i.js";var Ee={},se={};se.toString=function(c){switch(c){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+c};se.toType=function(c){switch(c.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":return 255;case"*":return 255}return c.toUpperCase().startsWith("UNKNOWN_")?parseInt(c.slice(8)):0};var ge={};ge.toString=function(c){switch(c){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+c};ge.toRcode=function(c){switch(c.toUpperCase()){case"NOERROR":return 0;case"FORMERR":return 1;case"SERVFAIL":return 2;case"NXDOMAIN":return 3;case"NOTIMP":return 4;case"REFUSED":return 5;case"YXDOMAIN":return 6;case"YXRRSET":return 7;case"NXRRSET":return 8;case"NOTAUTH":return 9;case"NOTZONE":return 10;case"RCODE_11":return 11;case"RCODE_12":return 12;case"RCODE_13":return 13;case"RCODE_14":return 14;case"RCODE_15":return 15}return 0};var ue={};ue.toString=function(c){switch(c){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+c};ue.toOpcode=function(c){switch(c.toUpperCase()){case"QUERY":return 0;case"IQUERY":return 1;case"STATUS":return 2;case"OPCODE_3":return 3;case"NOTIFY":return 4;case"UPDATE":return 5;case"OPCODE_6":return 6;case"OPCODE_7":return 7;case"OPCODE_8":return 8;case"OPCODE_9":return 9;case"OPCODE_10":return 10;case"OPCODE_11":return 11;case"OPCODE_12":return 12;case"OPCODE_13":return 13;case"OPCODE_14":return 14;case"OPCODE_15":return 15}return 0};var he={};he.toString=function(c){switch(c){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+c};he.toClass=function(c){switch(c.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0};var ye={};ye.toString=function(c){switch(c){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return c<0?null:`OPTION_${c}`};ye.toCode=function(c){if(typeof c=="number")return c;if(!c)return-1;switch(c.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const i=c.match(/_(\d+)$/);return i?parseInt(i[1],10):-1};var Ie={exports:{}};(function(c,i){var h=function(y){Object.defineProperty(y,"__esModule",{value:!0}),y.decode=a,y.encode=C,y.familyOf=I,y.name=void 0,y.sizeOf=g,y.v6=y.v4=void 0;const m=/^(\d{1,3}\.){3,3}\d{1,3}$/,O=4,U=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,v=16,w={name:"v4",size:O,isFormat:l=>m.test(l),encode(l,s,o){o=~~o,s=s||new Uint8Array(o+O);const E=l.length;let L=0;for(let N=0;N<E;){const A=l.charCodeAt(N++);A===46?(s[o++]=L,L=0):L=L*10+(A-48)}return s[o]=L,s},decode(l,s){return s=~~s,`${l[s++]}.${l[s++]}.${l[s++]}.${l[s]}`}};y.v4=w;const p={name:"v6",size:v,isFormat:l=>l.length>0&&U.test(l),encode(l,s,o){o=~~o;let E=o+v,L=-1,N=0,A=0,M=!0,R=!1;s=s||new Uint8Array(o+v);for(let z=0;z<l.length;z++){let K=l.charCodeAt(z);K===58?(M?L!==-1?(o<E&&(s[o]=0),o<E-1&&(s[o+1]=0),o+=2):o<E&&(L=o):(R===!0?(o<E&&(s[o]=A),o++):(o<E&&(s[o]=N>>8),o<E-1&&(s[o+1]=N&255),o+=2),N=0,A=0),M=!0,R=!1):K===46?(o<E&&(s[o]=A),o++,A=0,N=0,M=!1,R=!0):(M=!1,K>=97?K-=87:K>=65?K-=55:(K-=48,A=A*10+K),N=(N<<4)+K)}if(M===!1)R===!0?(o<E&&(s[o]=A),o++):(o<E&&(s[o]=N>>8),o<E-1&&(s[o+1]=N&255),o+=2);else if(L===0)o<E&&(s[o]=0),o<E-1&&(s[o+1]=0),o+=2;else if(L!==-1){o+=2;for(let z=Math.min(o-1,E-1);z>=L+2;z--)s[z]=s[z-2];s[L]=0,s[L+1]=0,L=o}if(L!==o&&L!==-1)for(o>E-2&&(o=E-2);E>L;)s[--E]=o<E&&o>L?s[--o]:0;else for(;o<E;)s[o++]=0;return s},decode(l,s){s=~~s;let o="";for(let E=0;E<v;E+=2)E!==0&&(o+=":"),o+=(l[s+E]<<8|l[s+E+1]).toString(16);return o.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};y.v6=p;const $="ip";y.name=$;function g(l){if(w.isFormat(l))return w.size;if(p.isFormat(l))return p.size;throw Error(`Invalid ip address: ${l}`)}function I(l){return g(l)===w.size?1:2}function C(l,s,o){o=~~o;const E=g(l);return typeof s=="function"&&(s=s(o+E)),E===w.size?w.encode(l,s,o):p.encode(l,s,o)}function a(l,s,o){if(s=~~s,o=o||l.length-s,o===w.size)return w.decode(l,s,o);if(o===p.size)return p.decode(l,s,o);throw Error(`Invalid buffer size needs to be ${w.size} for v4 or ${p.size} for v6.`)}return"default"in y?y.default:y}({});c.exports=h})(Ie);var Pe=Ie.exports;(function(c){const i=pe.Buffer,h=se,y=ge,m=ue,O=he,U=ye,v=Pe,w=0,p=32768,$=32768,g=~$,I=32768,C=~I,a=c.name={};a.encode=function(r,e,n,{mail:t=!1}={}){e||(e=i.alloc(a.encodingLength(r))),n||(n=0);const d=n,u=r.replace(/^\.|\.$/gm,"");if(u.length){let S=[];if(t){let B="";u.split(".").forEach(T=>{T.endsWith("\\")?B+=(B.length?".":"")+T.slice(0,-1):S.length===0&&B.length?S.push(B+"."+T):S.push(T)})}else S=u.split(".");for(let B=0;B<S.length;B++){const T=e.write(S[B],n+1);e[n]=T,n+=T+1}}return e[n++]=0,a.encode.bytes=n-d,e},a.encode.bytes=0,a.decode=function(r,e,{mail:n=!1}={}){e||(e=0);const t=[];let d=e,u=0,S=0,B=!1;for(;;){if(e>=r.length)throw new Error("Cannot decode name (buffer overflow)");const T=r[e++];if(S+=B?0:1,T===0)break;if(T&192)if((T&192)===192){if(e+1>r.length)throw new Error("Cannot decode name (buffer overflow)");const P=r.readUInt16BE(e-1)-49152;if(P>=d)throw new Error("Cannot decode name (bad pointer)");e=P,d=P,S+=B?0:1,B=!0}else throw new Error("Cannot decode name (bad label)");else{if(e+T>r.length)throw new Error("Cannot decode name (buffer overflow)");if(u+=T+1,u>254)throw new Error("Cannot decode name (name too long)");let P=r.toString("utf-8",e,e+T);n&&(P=P.replace(/\./g,"\\.")),t.push(P),e+=T,S+=B?0:T}}return a.decode.bytes=S,t.length===0?".":t.join(".")},a.decode.bytes=0,a.encodingLength=function(r){return r==="."||r===".."?1:i.byteLength(r.replace(/^\.|\.$/gm,""))+2};const l={};l.encode=function(r,e,n){e||(e=i.alloc(l.encodingLength(r))),n||(n=0);const t=e.write(r,n+1);return e[n]=t,l.encode.bytes=t+1,e},l.encode.bytes=0,l.decode=function(r,e){e||(e=0);const n=r[e],t=r.toString("utf-8",e+1,e+1+n);return l.decode.bytes=n+1,t},l.decode.bytes=0,l.encodingLength=function(r){return i.byteLength(r)+1};const s={};s.encode=function(r,e,n){e||(e=s.encodingLength(r)),n||(n=0);const t=(r.flags||0)&32767,d=r.type==="response"?p:w;return e.writeUInt16BE(r.id||0,n),e.writeUInt16BE(t|d,n+2),e.writeUInt16BE(r.questions.length,n+4),e.writeUInt16BE(r.answers.length,n+6),e.writeUInt16BE(r.authorities.length,n+8),e.writeUInt16BE(r.additionals.length,n+10),e},s.encode.bytes=12,s.decode=function(r,e){if(e||(e=0),r.length<12)throw new Error("Header must be 12 bytes");const n=r.readUInt16BE(e+2);return{id:r.readUInt16BE(e),type:n&p?"response":"query",flags:n&32767,flag_qr:(n>>15&1)===1,opcode:m.toString(n>>11&15),flag_aa:(n>>10&1)===1,flag_tc:(n>>9&1)===1,flag_rd:(n>>8&1)===1,flag_ra:(n>>7&1)===1,flag_z:(n>>6&1)===1,flag_ad:(n>>5&1)===1,flag_cd:(n>>4&1)===1,rcode:y.toString(n&15),questions:new Array(r.readUInt16BE(e+4)),answers:new Array(r.readUInt16BE(e+6)),authorities:new Array(r.readUInt16BE(e+8)),additionals:new Array(r.readUInt16BE(e+10))}},s.decode.bytes=12,s.encodingLength=function(){return 12};const o=c.unknown={};o.encode=function(r,e,n){return e||(e=i.alloc(o.encodingLength(r))),n||(n=0),e.writeUInt16BE(r.length,n),r.copy(e,n+2),o.encode.bytes=r.length+2,e},o.encode.bytes=0,o.decode=function(r,e){e||(e=0);const n=r.readUInt16BE(e),t=r.slice(e+2,e+2+n);return o.decode.bytes=n+2,t},o.decode.bytes=0,o.encodingLength=function(r){return r.length+2};const E=c.ns={};E.encode=function(r,e,n){return e||(e=i.alloc(E.encodingLength(r))),n||(n=0),a.encode(r,e,n+2),e.writeUInt16BE(a.encode.bytes,n),E.encode.bytes=a.encode.bytes+2,e},E.encode.bytes=0,E.decode=function(r,e){e||(e=0);const n=r.readUInt16BE(e),t=a.decode(r,e+2);return E.decode.bytes=n+2,t},E.decode.bytes=0,E.encodingLength=function(r){return a.encodingLength(r)+2};const L=c.soa={};L.encode=function(r,e,n){e||(e=i.alloc(L.encodingLength(r))),n||(n=0);const t=n;return n+=2,a.encode(r.mname,e,n),n+=a.encode.bytes,a.encode(r.rname,e,n,{mail:!0}),n+=a.encode.bytes,e.writeUInt32BE(r.serial||0,n),n+=4,e.writeUInt32BE(r.refresh||0,n),n+=4,e.writeUInt32BE(r.retry||0,n),n+=4,e.writeUInt32BE(r.expire||0,n),n+=4,e.writeUInt32BE(r.minimum||0,n),n+=4,e.writeUInt16BE(n-t-2,t),L.encode.bytes=n-t,e},L.encode.bytes=0,L.decode=function(r,e){e||(e=0);const n=e,t={};return e+=2,t.mname=a.decode(r,e),e+=a.decode.bytes,t.rname=a.decode(r,e,{mail:!0}),e+=a.decode.bytes,t.serial=r.readUInt32BE(e),e+=4,t.refresh=r.readUInt32BE(e),e+=4,t.retry=r.readUInt32BE(e),e+=4,t.expire=r.readUInt32BE(e),e+=4,t.minimum=r.readUInt32BE(e),e+=4,L.decode.bytes=e-n,t},L.decode.bytes=0,L.encodingLength=function(r){return 22+a.encodingLength(r.mname)+a.encodingLength(r.rname)};const N=c.txt={};N.encode=function(r,e,n){Array.isArray(r)||(r=[r]);for(let d=0;d<r.length;d++)if(typeof r[d]=="string"&&(r[d]=i.from(r[d])),!i.isBuffer(r[d]))throw new Error("Must be a Buffer");e||(e=i.alloc(N.encodingLength(r))),n||(n=0);const t=n;return n+=2,r.forEach(function(d){e[n++]=d.length,d.copy(e,n,0,d.length),n+=d.length}),e.writeUInt16BE(n-t-2,t),N.encode.bytes=n-t,e},N.encode.bytes=0,N.decode=function(r,e){e||(e=0);const n=e;let t=r.readUInt16BE(e);e+=2;let d=[];for(;t>0;){const u=r[e++];if(--t,t<u)throw new Error("Buffer overflow");d.push(r.slice(e,e+u)),e+=u,t-=u}return N.decode.bytes=e-n,d},N.decode.bytes=0,N.encodingLength=function(r){Array.isArray(r)||(r=[r]);let e=2;return r.forEach(function(n){typeof n=="string"?e+=i.byteLength(n)+1:e+=n.length+1}),e};const A=c.null={};A.encode=function(r,e,n){e||(e=i.alloc(A.encodingLength(r))),n||(n=0),typeof r=="string"&&(r=i.from(r)),r||(r=i.alloc(0));const t=n;n+=2;const d=r.length;return r.copy(e,n,0,d),n+=d,e.writeUInt16BE(n-t-2,t),A.encode.bytes=n-t,e},A.encode.bytes=0,A.decode=function(r,e){e||(e=0);const n=e,t=r.readUInt16BE(e);e+=2;const d=r.slice(e,e+t);return e+=t,A.decode.bytes=e-n,d},A.decode.bytes=0,A.encodingLength=function(r){return r?(i.isBuffer(r)?r.length:i.byteLength(r))+2:2};const M=c.hinfo={};M.encode=function(r,e,n){e||(e=i.alloc(M.encodingLength(r))),n||(n=0);const t=n;return n+=2,l.encode(r.cpu,e,n),n+=l.encode.bytes,l.encode(r.os,e,n),n+=l.encode.bytes,e.writeUInt16BE(n-t-2,t),M.encode.bytes=n-t,e},M.encode.bytes=0,M.decode=function(r,e){e||(e=0);const n=e,t={};return e+=2,t.cpu=l.decode(r,e),e+=l.decode.bytes,t.os=l.decode(r,e),e+=l.decode.bytes,M.decode.bytes=e-n,t},M.decode.bytes=0,M.encodingLength=function(r){return l.encodingLength(r.cpu)+l.encodingLength(r.os)+2};const R=c.ptr={},z=c.cname=R,K=c.dname=R;R.encode=function(r,e,n){return e||(e=i.alloc(R.encodingLength(r))),n||(n=0),a.encode(r,e,n+2),e.writeUInt16BE(a.encode.bytes,n),R.encode.bytes=a.encode.bytes+2,e},R.encode.bytes=0,R.decode=function(r,e){e||(e=0);const n=a.decode(r,e+2);return R.decode.bytes=a.decode.bytes+2,n},R.decode.bytes=0,R.encodingLength=function(r){return a.encodingLength(r)+2};const J=c.srv={};J.encode=function(r,e,n){e||(e=i.alloc(J.encodingLength(r))),n||(n=0),e.writeUInt16BE(r.priority||0,n+2),e.writeUInt16BE(r.weight||0,n+4),e.writeUInt16BE(r.port||0,n+6),a.encode(r.target,e,n+8);const t=a.encode.bytes+6;return e.writeUInt16BE(t,n),J.encode.bytes=t+2,e},J.encode.bytes=0,J.decode=function(r,e){e||(e=0);const n=r.readUInt16BE(e),t={};return t.priority=r.readUInt16BE(e+2),t.weight=r.readUInt16BE(e+4),t.port=r.readUInt16BE(e+6),t.target=a.decode(r,e+8),J.decode.bytes=n+2,t},J.decode.bytes=0,J.encodingLength=function(r){return 8+a.encodingLength(r.target)};const q=c.caa={};q.ISSUER_CRITICAL=128,q.encode=function(r,e,n){const t=q.encodingLength(r);return e||(e=i.alloc(q.encodingLength(r))),n||(n=0),r.issuerCritical&&(r.flags=q.ISSUER_CRITICAL),e.writeUInt16BE(t-2,n),n+=2,e.writeUInt8(r.flags||0,n),n+=1,l.encode(r.tag,e,n),n+=l.encode.bytes,e.write(r.value,n),n+=i.byteLength(r.value),q.encode.bytes=t,e},q.encode.bytes=0,q.decode=function(r,e){e||(e=0);const n=r.readUInt16BE(e);e+=2;const t=e,d={};return d.flags=r.readUInt8(e),e+=1,d.tag=l.decode(r,e),e+=l.decode.bytes,d.value=r.toString("utf-8",e,t+n),d.issuerCritical=!!(d.flags&q.ISSUER_CRITICAL),q.decode.bytes=n+2,d},q.decode.bytes=0,q.encodingLength=function(r){return l.encodingLength(r.tag)+l.encodingLength(r.value)+2};const ee=c.mx={};ee.encode=function(r,e,n){e||(e=i.alloc(ee.encodingLength(r))),n||(n=0);const t=n;return n+=2,e.writeUInt16BE(r.preference||0,n),n+=2,a.encode(r.exchange,e,n),n+=a.encode.bytes,e.writeUInt16BE(n-t-2,t),ee.encode.bytes=n-t,e},ee.encode.bytes=0,ee.decode=function(r,e){e||(e=0);const n=e,t={};return e+=2,t.preference=r.readUInt16BE(e),e+=2,t.exchange=a.decode(r,e),e+=a.decode.bytes,ee.decode.bytes=e-n,t},ee.encodingLength=function(r){return 4+a.encodingLength(r.exchange)};const b=c.a={};b.encode=function(r,e,n){return e||(e=i.alloc(b.encodingLength(r))),n||(n=0),e.writeUInt16BE(4,n),n+=2,v.v4.encode(r,e,n),b.encode.bytes=6,e},b.encode.bytes=0,b.decode=function(r,e){e||(e=0),e+=2;const n=v.v4.decode(r,e);return b.decode.bytes=6,n},b.decode.bytes=0,b.encodingLength=function(){return 6};const f=c.aaaa={};f.encode=function(r,e,n){return e||(e=i.alloc(f.encodingLength(r))),n||(n=0),e.writeUInt16BE(16,n),n+=2,v.v6.encode(r,e,n),f.encode.bytes=18,e},f.encode.bytes=0,f.decode=function(r,e){e||(e=0),e+=2;const n=v.v6.decode(r,e);return f.decode.bytes=18,n},f.decode.bytes=0,f.encodingLength=function(){return 18};const F=c.option={};F.encode=function(r,e,n){e||(e=i.alloc(F.encodingLength(r))),n||(n=0);const t=n,d=U.toCode(r.code);if(e.writeUInt16BE(d,n),n+=2,r.data)e.writeUInt16BE(r.data.length,n),n+=2,r.data.copy(e,n),n+=r.data.length;else switch(d){case 8:const u=r.sourcePrefixLength||0,S=r.family||v.familyOf(r.ip),B=v.encode(r.ip,i.alloc),T=Math.ceil(u/8);e.writeUInt16BE(T+4,n),n+=2,e.writeUInt16BE(S,n),n+=2,e.writeUInt8(u,n++),e.writeUInt8(r.scopePrefixLength||0,n++),B.copy(e,n,0,T),n+=T;break;case 11:r.timeout?(e.writeUInt16BE(2,n),n+=2,e.writeUInt16BE(r.timeout,n),n+=2):(e.writeUInt16BE(0,n),n+=2);break;case 12:const P=r.length||0;e.writeUInt16BE(P,n),n+=2,e.fill(0,n,n+P),n+=P;break;case 14:const de=r.tags.length*2;e.writeUInt16BE(de,n),n+=2;for(const we of r.tags)e.writeUInt16BE(we,n),n+=2;break;default:throw new Error(`Unknown roption code: ${r.code}`)}return F.encode.bytes=n-t,e},F.encode.bytes=0,F.decode=function(r,e){e||(e=0);const n={};n.code=r.readUInt16BE(e),n.type=U.toString(n.code),e+=2;const t=r.readUInt16BE(e);switch(e+=2,n.data=r.slice(e,e+t),n.code){case 8:n.family=r.readUInt16BE(e),e+=2,n.sourcePrefixLength=r.readUInt8(e++),n.scopePrefixLength=r.readUInt8(e++);const d=i.alloc(n.family===1?4:16);r.copy(d,0,e,e+t-4),n.ip=v.decode(d);break;case 11:t>0&&(n.timeout=r.readUInt16BE(e),e+=2);break;case 14:n.tags=[];for(let u=0;u<t;u+=2)n.tags.push(r.readUInt16BE(e)),e+=2}return F.decode.bytes=t+4,n},F.decode.bytes=0,F.encodingLength=function(r){if(r.data)return r.data.length+4;switch(U.toCode(r.code)){case 8:const n=r.sourcePrefixLength||0;return Math.ceil(n/8)+8;case 11:return typeof r.timeout=="number"?6:4;case 12:return r.length+4;case 14:return 4+r.tags.length*2}throw new Error(`Unknown roption code: ${r.code}`)};const H=c.opt={};H.encode=function(r,e,n){e||(e=i.alloc(H.encodingLength(r))),n||(n=0);const t=n,d=ne(r,F);return e.writeUInt16BE(d,n),n=re(r,F,e,n+2),H.encode.bytes=n-t,e},H.encode.bytes=0,H.decode=function(r,e){e||(e=0);const n=e,t=[];let d=r.readUInt16BE(e);e+=2;let u=0;for(;d>0;)t[u++]=F.decode(r,e),e+=F.decode.bytes,d-=F.decode.bytes;return H.decode.bytes=e-n,t},H.decode.bytes=0,H.encodingLength=function(r){return 2+ne(r||[],F)};const k=c.dnskey={};k.PROTOCOL_DNSSEC=3,k.ZONE_KEY=128,k.SECURE_ENTRYPOINT=32768,k.encode=function(r,e,n){e||(e=i.alloc(k.encodingLength(r))),n||(n=0);const t=n,d=r.key;if(!i.isBuffer(d))throw new Error("Key must be a Buffer");return n+=2,e.writeUInt16BE(r.flags,n),n+=2,e.writeUInt8(k.PROTOCOL_DNSSEC,n),n+=1,e.writeUInt8(r.algorithm,n),n+=1,d.copy(e,n,0,d.length),n+=d.length,k.encode.bytes=n-t,e.writeUInt16BE(k.encode.bytes-2,t),e},k.encode.bytes=0,k.decode=function(r,e){e||(e=0);const n=e;var t={},d=r.readUInt16BE(e);if(e+=2,t.flags=r.readUInt16BE(e),e+=2,r.readUInt8(e)!==k.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return e+=1,t.algorithm=r.readUInt8(e),e+=1,t.key=r.slice(e,n+d+2),e+=t.key.length,k.decode.bytes=e-n,t},k.decode.bytes=0,k.encodingLength=function(r){return 6+i.byteLength(r.key)};const x=c.rrsig={};x.encode=function(r,e,n){e||(e=i.alloc(x.encodingLength(r))),n||(n=0);const t=n,d=r.signature;if(!i.isBuffer(d))throw new Error("Signature must be a Buffer");return n+=2,e.writeUInt16BE(h.toType(r.typeCovered),n),n+=2,e.writeUInt8(r.algorithm,n),n+=1,e.writeUInt8(r.labels,n),n+=1,e.writeUInt32BE(r.originalTTL,n),n+=4,e.writeUInt32BE(r.expiration,n),n+=4,e.writeUInt32BE(r.inception,n),n+=4,e.writeUInt16BE(r.keyTag,n),n+=2,a.encode(r.signersName,e,n),n+=a.encode.bytes,d.copy(e,n,0,d.length),n+=d.length,x.encode.bytes=n-t,e.writeUInt16BE(x.encode.bytes-2,t),e},x.encode.bytes=0,x.decode=function(r,e){e||(e=0);const n=e;var t={},d=r.readUInt16BE(e);return e+=2,t.typeCovered=h.toString(r.readUInt16BE(e)),e+=2,t.algorithm=r.readUInt8(e),e+=1,t.labels=r.readUInt8(e),e+=1,t.originalTTL=r.readUInt32BE(e),e+=4,t.expiration=r.readUInt32BE(e),e+=4,t.inception=r.readUInt32BE(e),e+=4,t.keyTag=r.readUInt16BE(e),e+=2,t.signersName=a.decode(r,e),e+=a.decode.bytes,t.signature=r.slice(e,n+d+2),e+=t.signature.length,x.decode.bytes=e-n,t},x.decode.bytes=0,x.encodingLength=function(r){return 20+a.encodingLength(r.signersName)+i.byteLength(r.signature)};const V=c.rp={};V.encode=function(r,e,n){e||(e=i.alloc(V.encodingLength(r))),n||(n=0);const t=n;return n+=2,a.encode(r.mbox||".",e,n,{mail:!0}),n+=a.encode.bytes,a.encode(r.txt||".",e,n),n+=a.encode.bytes,V.encode.bytes=n-t,e.writeUInt16BE(V.encode.bytes-2,t),e},V.encode.bytes=0,V.decode=function(r,e){e||(e=0);const n=e,t={};return e+=2,t.mbox=a.decode(r,e,{mail:!0})||".",e+=a.decode.bytes,t.txt=a.decode(r,e)||".",e+=a.decode.bytes,V.decode.bytes=e-n,t},V.decode.bytes=0,V.encodingLength=function(r){return 2+a.encodingLength(r.mbox||".")+a.encodingLength(r.txt||".")};const D={};D.encode=function(r,e,n){e||(e=i.alloc(D.encodingLength(r))),n||(n=0);const t=n;for(var d=[],u=0;u<r.length;u++){var S=h.toType(r[u]);d[S>>8]===void 0&&(d[S>>8]=[]),d[S>>8][S>>3&31]|=1<<7-(S&7)}for(u=0;u<d.length;u++)if(d[u]!==void 0){var B=i.from(d[u]);e.writeUInt8(u,n),n+=1,e.writeUInt8(B.length,n),n+=1,B.copy(e,n),n+=B.length}return D.encode.bytes=n-t,e},D.encode.bytes=0,D.decode=function(r,e,n){e||(e=0);const t=e;for(var d=[];e-t<n;){var u=r.readUInt8(e);e+=1;var S=r.readUInt8(e);e+=1;for(var B=0;B<S;B++)for(var T=r.readUInt8(e+B),P=0;P<8;P++)if(T&1<<7-P){var de=h.toString(u<<8|B<<3|P);d.push(de)}e+=S}return D.decode.bytes=e-t,d},D.decode.bytes=0,D.encodingLength=function(r){for(var e=[],n=0;n<r.length;n++){var t=h.toType(r[n]);e[t>>8]=Math.max(e[t>>8]||0,t&255)}var d=0;for(n=0;n<e.length;n++)e[n]!==void 0&&(d+=2+Math.ceil((e[n]+1)/8));return d};const G=c.nsec={};G.encode=function(r,e,n){e||(e=i.alloc(G.encodingLength(r))),n||(n=0);const t=n;return n+=2,a.encode(r.nextDomain,e,n),n+=a.encode.bytes,D.encode(r.rrtypes,e,n),n+=D.encode.bytes,G.encode.bytes=n-t,e.writeUInt16BE(G.encode.bytes-2,t),e},G.encode.bytes=0,G.decode=function(r,e){e||(e=0);const n=e;var t={},d=r.readUInt16BE(e);return e+=2,t.nextDomain=a.decode(r,e),e+=a.decode.bytes,t.rrtypes=D.decode(r,e,d-(e-n)),e+=D.decode.bytes,G.decode.bytes=e-n,t},G.decode.bytes=0,G.encodingLength=function(r){return 2+a.encodingLength(r.nextDomain)+D.encodingLength(r.rrtypes)};const Q=c.nsec3={};Q.encode=function(r,e,n){e||(e=i.alloc(Q.encodingLength(r))),n||(n=0);const t=n,d=r.salt;if(!i.isBuffer(d))throw new Error("salt must be a Buffer");const u=r.nextDomain;if(!i.isBuffer(u))throw new Error("nextDomain must be a Buffer");return n+=2,e.writeUInt8(r.algorithm,n),n+=1,e.writeUInt8(r.flags,n),n+=1,e.writeUInt16BE(r.iterations,n),n+=2,e.writeUInt8(d.length,n),n+=1,d.copy(e,n,0,d.length),n+=d.length,e.writeUInt8(u.length,n),n+=1,u.copy(e,n,0,u.length),n+=u.length,D.encode(r.rrtypes,e,n),n+=D.encode.bytes,Q.encode.bytes=n-t,e.writeUInt16BE(Q.encode.bytes-2,t),e},Q.encode.bytes=0,Q.decode=function(r,e){e||(e=0);const n=e;var t={},d=r.readUInt16BE(e);e+=2,t.algorithm=r.readUInt8(e),e+=1,t.flags=r.readUInt8(e),e+=1,t.iterations=r.readUInt16BE(e),e+=2;const u=r.readUInt8(e);e+=1,t.salt=r.slice(e,e+u),e+=u;const S=r.readUInt8(e);return e+=1,t.nextDomain=r.slice(e,e+S),e+=S,t.rrtypes=D.decode(r,e,d-(e-n)),e+=D.decode.bytes,Q.decode.bytes=e-n,t},Q.decode.bytes=0,Q.encodingLength=function(r){return 8+r.salt.length+r.nextDomain.length+D.encodingLength(r.rrtypes)};const W=c.ds={};W.encode=function(r,e,n){e||(e=i.alloc(W.encodingLength(r))),n||(n=0);const t=n,d=r.digest;if(!i.isBuffer(d))throw new Error("Digest must be a Buffer");return n+=2,e.writeUInt16BE(r.keyTag,n),n+=2,e.writeUInt8(r.algorithm,n),n+=1,e.writeUInt8(r.digestType,n),n+=1,d.copy(e,n,0,d.length),n+=d.length,W.encode.bytes=n-t,e.writeUInt16BE(W.encode.bytes-2,t),e},W.encode.bytes=0,W.decode=function(r,e){e||(e=0);const n=e;var t={},d=r.readUInt16BE(e);return e+=2,t.keyTag=r.readUInt16BE(e),e+=2,t.algorithm=r.readUInt8(e),e+=1,t.digestType=r.readUInt8(e),e+=1,t.digest=r.slice(e,n+d+2),e+=t.digest.length,W.decode.bytes=e-n,t},W.decode.bytes=0,W.encodingLength=function(r){return 6+i.byteLength(r.digest)};const Y=c.sshfp={};Y.getFingerprintLengthForHashType=function(e){switch(e){case 1:return 20;case 2:return 32}},Y.encode=function(e,n,t){n||(n=i.alloc(Y.encodingLength(e))),t||(t=0);const d=t;t+=2,n[t]=e.algorithm,t+=1,n[t]=e.hash,t+=1;const u=i.from(e.fingerprint.toUpperCase(),"hex");if(u.length!==Y.getFingerprintLengthForHashType(e.hash))throw new Error("Invalid fingerprint length");return u.copy(n,t),t+=u.byteLength,Y.encode.bytes=t-d,n.writeUInt16BE(Y.encode.bytes-2,d),n},Y.encode.bytes=0,Y.decode=function(e,n){n||(n=0);const t=n,d={};n+=2,d.algorithm=e[n],n+=1,d.hash=e[n],n+=1;const u=Y.getFingerprintLengthForHashType(d.hash);return d.fingerprint=e.slice(n,n+u).toString("hex").toUpperCase(),n+=u,Y.decode.bytes=n-t,d},Y.decode.bytes=0,Y.encodingLength=function(r){return 4+i.from(r.fingerprint,"hex").byteLength};const j=c.naptr={};j.encode=function(r,e,n){e||(e=i.alloc(j.encodingLength(r))),n||(n=0);const t=n;return n+=2,e.writeUInt16BE(r.order||0,n),n+=2,e.writeUInt16BE(r.preference||0,n),n+=2,l.encode(r.flags,e,n),n+=l.encode.bytes,l.encode(r.services,e,n),n+=l.encode.bytes,l.encode(r.regexp,e,n),n+=l.encode.bytes,a.encode(r.replacement,e,n),n+=a.encode.bytes,j.encode.bytes=n-t,e.writeUInt16BE(j.encode.bytes-2,t),e},j.encode.bytes=0,j.decode=function(r,e){e||(e=0);const n=e,t={};return e+=2,t.order=r.readUInt16BE(e),e+=2,t.preference=r.readUInt16BE(e),e+=2,t.flags=l.decode(r,e),e+=l.decode.bytes,t.services=l.decode(r,e),e+=l.decode.bytes,t.regexp=l.decode(r,e),e+=l.decode.bytes,t.replacement=a.decode(r,e),e+=a.decode.bytes,j.decode.bytes=e-n,t},j.decode.bytes=0,j.encodingLength=function(r){return l.encodingLength(r.flags)+l.encodingLength(r.services)+l.encodingLength(r.regexp)+a.encodingLength(r.replacement)+6};const Z=c.tlsa={};Z.encode=function(r,e,n){e||(e=i.alloc(Z.encodingLength(r))),n||(n=0);const t=n,d=r.certificate;if(!i.isBuffer(d))throw new Error("Certificate must be a Buffer");return n+=2,e.writeUInt8(r.usage,n),n+=1,e.writeUInt8(r.selector,n),n+=1,e.writeUInt8(r.matchingType,n),n+=1,d.copy(e,n,0,d.length),n+=d.length,Z.encode.bytes=n-t,e.writeUInt16BE(Z.encode.bytes-2,t),e},Z.encode.bytes=0,Z.decode=function(r,e){e||(e=0);const n=e,t={},d=r.readUInt16BE(e);return e+=2,t.usage=r.readUInt8(e),e+=1,t.selector=r.readUInt8(e),e+=1,t.matchingType=r.readUInt8(e),e+=1,t.certificate=r.slice(e,n+d+2),e+=t.certificate.length,Z.decode.bytes=e-n,t},Z.decode.bytes=0,Z.encodingLength=function(r){return 5+i.byteLength(r.certificate)};const ie=c.record=function(r){switch(r.toUpperCase()){case"A":return b;case"PTR":return R;case"CNAME":return z;case"DNAME":return K;case"TXT":return N;case"NULL":return A;case"AAAA":return f;case"SRV":return J;case"HINFO":return M;case"CAA":return q;case"NS":return E;case"SOA":return L;case"MX":return ee;case"OPT":return H;case"DNSKEY":return k;case"RRSIG":return x;case"RP":return V;case"NSEC":return G;case"NSEC3":return Q;case"SSHFP":return Y;case"DS":return W;case"NAPTR":return j;case"TLSA":return Z}return o},_=c.answer={};_.encode=function(r,e,n){e||(e=i.alloc(_.encodingLength(r))),n||(n=0);const t=n;if(a.encode(r.name,e,n),n+=a.encode.bytes,e.writeUInt16BE(h.toType(r.type),n),r.type.toUpperCase()==="OPT"){if(r.name!==".")throw new Error("OPT name must be root.");e.writeUInt16BE(r.udpPayloadSize||4096,n+2),e.writeUInt8(r.extendedRcode||0,n+4),e.writeUInt8(r.ednsVersion||0,n+5),e.writeUInt16BE(r.flags||0,n+6),n+=8,H.encode(r.options||[],e,n),n+=H.encode.bytes}else{let d=O.toClass(r.class===void 0?"IN":r.class);r.flush&&(d|=$),e.writeUInt16BE(d,n+2),e.writeUInt32BE(r.ttl||0,n+4),n+=8;const u=ie(r.type);u.encode(r.data,e,n),n+=u.encode.bytes}return _.encode.bytes=n-t,e},_.encode.bytes=0,_.decode=function(r,e){e||(e=0);const n={},t=e;if(n.name=a.decode(r,e),e+=a.decode.bytes,n.type=h.toString(r.readUInt16BE(e)),n.type==="OPT")n.udpPayloadSize=r.readUInt16BE(e+2),n.extendedRcode=r.readUInt8(e+4),n.ednsVersion=r.readUInt8(e+5),n.flags=r.readUInt16BE(e+6),n.flag_do=(n.flags>>15&1)===1,n.options=H.decode(r,e+8),e+=8+H.decode.bytes;else{const d=r.readUInt16BE(e+2);n.ttl=r.readUInt32BE(e+4),n.class=O.toString(d&g),n.flush=!!(d&$);const u=ie(n.type);n.data=u.decode(r,e+8),e+=8+u.decode.bytes}return _.decode.bytes=e-t,n},_.decode.bytes=0,_.encodingLength=function(r){const e=r.data!==null&&r.data!==void 0?r.data:r.options;return a.encodingLength(r.name)+8+ie(r.type).encodingLength(e)};const X=c.question={};X.encode=function(r,e,n){e||(e=i.alloc(X.encodingLength(r))),n||(n=0);const t=n;return a.encode(r.name,e,n),n+=a.encode.bytes,e.writeUInt16BE(h.toType(r.type),n),n+=2,e.writeUInt16BE(O.toClass(r.class===void 0?"IN":r.class),n),n+=2,X.encode.bytes=n-t,r},X.encode.bytes=0,X.decode=function(r,e){e||(e=0);const n=e,t={};return t.name=a.decode(r,e),e+=a.decode.bytes,t.type=h.toString(r.readUInt16BE(e)),e+=2,t.class=O.toString(r.readUInt16BE(e)),e+=2,!!(t.class&I)&&(t.class&=C),X.decode.bytes=e-n,t},X.decode.bytes=0,X.encodingLength=function(r){return a.encodingLength(r.name)+4},c.AUTHORITATIVE_ANSWER=1024,c.TRUNCATED_RESPONSE=512,c.RECURSION_DESIRED=256,c.RECURSION_AVAILABLE=128,c.AUTHENTIC_DATA=32,c.CHECKING_DISABLED=16,c.DNSSEC_OK=32768,c.encode=function(r,e,n){const t=!e;t&&(e=i.alloc(c.encodingLength(r))),n||(n=0);const d=n;return r.questions||(r.questions=[]),r.answers||(r.answers=[]),r.authorities||(r.authorities=[]),r.additionals||(r.additionals=[]),s.encode(r,e,n),n+=s.encode.bytes,n=re(r.questions,X,e,n),n=re(r.answers,_,e,n),n=re(r.authorities,_,e,n),n=re(r.additionals,_,e,n),c.encode.bytes=n-d,t&&c.encode.bytes!==e.length?e.slice(0,c.encode.bytes):e},c.encode.bytes=0,c.decode=function(r,e){e||(e=0);const n=e,t=s.decode(r,e);return e+=s.decode.bytes,e=te(t.questions,X,r,e),e=te(t.answers,_,r,e),e=te(t.authorities,_,r,e),e=te(t.additionals,_,r,e),c.decode.bytes=e-n,t},c.decode.bytes=0,c.encodingLength=function(r){return s.encodingLength(r)+ne(r.questions||[],X)+ne(r.answers||[],_)+ne(r.authorities||[],_)+ne(r.additionals||[],_)},c.streamEncode=function(r){const e=c.encode(r),n=i.alloc(2);n.writeUInt16BE(e.byteLength);const t=i.concat([n,e]);return c.streamEncode.bytes=t.byteLength,t},c.streamEncode.bytes=0,c.streamDecode=function(r){const e=r.readUInt16BE(0);if(r.byteLength<e+2)return null;const n=c.decode(r.slice(2));return c.streamDecode.bytes=c.decode.bytes,n},c.streamDecode.bytes=0;function ne(r,e){let n=0;for(let t=0;t<r.length;t++)n+=e.encodingLength(r[t]);return n}function re(r,e,n,t){for(let d=0;d<r.length;d++)e.encode(r[d],n,t),t+=e.encode.bytes;return t}function te(r,e,n,t){for(let d=0;d<r.length;d++)r[d]=e.decode(n,t),t+=e.decode.bytes;return t}})(Ee);var me=$e;ce.nextTick(Ye,42);var Me=ke;function ke(c){var i=y;return h;function h(m){i(m||qe)}function y(m){var O=[m];i=U,c(v);function U(w){O.push(w)}function v(w){var p=arguments;for(i=Fe(w)?y:$;O.length;)$(O.shift());function $(g){me(He,g,p)}}}}function Fe(c){return Object.prototype.toString.call(c)==="[object Error]"}function qe(){}function He(c,i){c.apply(null,i)}function Ye(c){c===42&&(me=ce.nextTick)}function $e(c,i,h){ce.nextTick(function(){c(i,h)})}const Ke=Oe(Re);var ae=Ee,Xe=ve,ze=Me,xe=Se,oe=Ke,le=function(){},Ve=function(c){c||(c={});var i=new xe.EventEmitter,h=typeof c.port=="number"?c.port:5353,y=c.type||"udp4",m=c.ip||c.host||(y==="udp4"?"224.0.0.251":null),O={address:m,port:h},U={},v=!1,w=null;if(y==="udp6"&&(!m||!c.interface))throw new Error("For IPv6 multicast you must specify `ip` and `interface`");var p=c.socket||Xe.createSocket({type:y,reuseAddr:c.reuseAddr!==!1,toString:function(){return y}});p.on("error",function(g){g.code==="EACCES"||g.code==="EADDRINUSE"?i.emit("error",g):i.emit("warning",g)}),p.on("message",function(g,I){try{g=ae.decode(g)}catch(C){i.emit("warning",C);return}i.emit("packet",g,I),g.type==="query"&&i.emit("query",g,I),g.type==="response"&&i.emit("response",g,I)}),p.on("listening",function(){h||(h=O.port=p.address().port),c.multicast!==!1&&(i.update(),w=setInterval(i.update,5e3),p.setMulticastTTL(c.ttl||255),p.setMulticastLoopback(c.loopback!==!1))});var $=ze(function(g){if(!h||c.bind===!1)return g(null);p.once("error",g),p.bind(h,c.bind||c.interface,function(){p.removeListener("error",g),g(null)})});return $(function(g){if(g)return i.emit("error",g);i.emit("ready")}),i.send=function(g,I,C){if(typeof I=="function")return i.send(g,null,I);C||(C=le),I?!I.host&&!I.address&&(I.address=O.address):I=O,$(a);function a(l){if(v)return C();if(l)return C(l);var s=ae.encode(g);p.send(s,0,s.length,I.port,I.address||I.host,C)}},i.response=i.respond=function(g,I,C){Array.isArray(g)&&(g={answers:g}),g.type="response",g.flags=(g.flags||0)|ae.AUTHORITATIVE_ANSWER,i.send(g,I,C)},i.query=function(g,I,C,a){if(typeof I=="function")return i.query(g,null,null,I);if(typeof I=="object"&&I&&I.port)return i.query(g,null,I,C);if(typeof C=="function")return i.query(g,I,null,C);a||(a=le),typeof g=="string"&&(g=[{name:g,type:I||"ANY"}]),Array.isArray(g)&&(g={type:"query",questions:g}),g.type="query",i.send(g,C,a)},i.destroy=function(g){if(g||(g=le),v)return ce.nextTick(g);v=!0,clearInterval(w);for(var I in U)try{p.dropMembership(m,I)}catch{}U={},p.close(g)},i.update=function(){for(var g=c.interface?[].concat(c.interface):Qe(),I=!1,C=0;C<g.length;C++){var a=g[C];if(!U[a])try{p.addMembership(m,a),U[a]=!0,I=!0}catch(l){i.emit("warning",l)}}if(I){if(p.setMulticastInterface)try{p.setMulticastInterface(c.interface||Ge())}catch(l){i.emit("warning",l)}i.emit("networkInterface")}},i};function Ge(){for(var c=oe.networkInterfaces(),i=Object.keys(c),h=0;h<i.length;h++)for(var y=c[i[h]],m=0;m<y.length;m++){var O=y[m];if(Ue(O.family)&&!O.internal)return oe.platform()==="darwin"&&i[h]==="en0"?O.address:"0.0.0.0"}return"127.0.0.1"}function Qe(){for(var c=oe.networkInterfaces(),i=Object.keys(c),h=[],y=0;y<i.length;y++)for(var m=c[i[y]],O=0;O<m.length;O++){var U=m[O];if(Ue(U.family)){h.push(U.address);break}}return h}function Ue(c){return c===4||c==="IPv4"}const We=Le(Ve);function je(c,i,h,y){const m=()=>{y?.log.trace("query",i),c.query({questions:[{name:i,type:"PTR"}]})};return m(),setInterval(m,h)}function Ze(c,i,h,y){if(c.answers==null)return;let m;const O=[];if(c.answers.forEach(U=>{switch(U.type){case"PTR":m=U;break;case"TXT":O.push(U);break}}),c.additionals.forEach(U=>{switch(U.type){case"TXT":O.push(U);break}}),!(m==null||m?.name!==h||O.length===0||m.data.startsWith(i)))try{const U=O.flatMap(w=>w.data).filter(w=>w.toString().startsWith("dnsaddr=")).map(w=>Be(w.toString().substring(8))),v=U[0].getPeerId();if(v==null)throw new Error("Multiaddr doesn't contain PeerId");return y?.log("peer found %p",v),{id:Ce(v),multiaddrs:U.map(w=>w.decapsulateCode(Te("p2p").code))}}catch(U){y?.log.error("failed to parse mdns response",U)}}function Je(c,i,h,y,m,O,U){if(!O){U?.log("not responding to mDNS query as broadcast mode is false");return}if(y.length!==0&&c.questions[0]!=null&&c.questions[0].name===m){const v=[];v.push({name:m,type:"PTR",class:"IN",ttl:120,data:h+"."+m}),y.filter(be).forEach(w=>{const p="dnsaddr="+w.toString();if(p.length>255){U?.log("multiaddr %a is too long to use in mDNS query response",w);return}if(w.getPeerId()==null){U?.log("multiaddr %a did not have a peer ID so cannot be used in mDNS query response",w);return}v.push({name:h+"."+m,type:"TXT",class:"IN",ttl:120,data:p})}),U?.log.trace("responding to query"),i.respond(v)}}function be(c){return!!Ne(c)}function fe(c){let i="";const h="abcdefghijklmnopqrstuvwxyz0123456789";for(let y=0;y<c;y++)i+=h.charAt(Math.floor(Math.random()*h.length));return i}class en extends Ae{mdns;log;broadcast;interval;serviceTag;peerName;port;ip;_queryInterval;components;constructor(i,h={}){if(super(),this.log=i.logger.forComponent("libp2p:mdns"),this.broadcast=h.broadcast!==!1,this.interval=h.interval??1e3*10,this.serviceTag=h.serviceTag??"_p2p._udp.local",this.ip=h.ip??"224.0.0.251",this.peerName=h.peerName??fe(63),this.peerName.length>=64)throw new Error("Peer name should be less than 64 chars long");this.port=h.port??5353,this.components=i,this._queryInterval=null,this._onMdnsQuery=this._onMdnsQuery.bind(this),this._onMdnsResponse=this._onMdnsResponse.bind(this),this._onMdnsWarning=this._onMdnsWarning.bind(this),this._onMdnsError=this._onMdnsError.bind(this)}[De]=this;[Symbol.toStringTag]="@libp2p/mdns";isStarted(){return!!this.mdns}async start(){this.mdns==null&&(this.mdns=We({port:this.port,ip:this.ip}),this.mdns.on("query",this._onMdnsQuery),this.mdns.on("response",this._onMdnsResponse),this.mdns.on("warning",this._onMdnsWarning),this.mdns.on("error",this._onMdnsError),this._queryInterval=je(this.mdns,this.serviceTag,this.interval,{log:this.log}))}_onMdnsQuery(i){this.mdns!=null&&(this.log.trace("received incoming mDNS query"),Je(i,this.mdns,this.peerName,this.components.addressManager.getAddresses(),this.serviceTag,this.broadcast,{log:this.log}))}_onMdnsResponse(i){this.log.trace("received mDNS query response");try{const h=Ze(i,this.peerName,this.serviceTag,{log:this.log});h!=null&&(this.log("discovered peer in mDNS query response %p",h.id),this.dispatchEvent(new _e("peer",{detail:h})))}catch(h){this.log.error("Error processing peer response",h)}}_onMdnsWarning(i){this.log.error("mdns warning",i)}_onMdnsError(i){this.log.error("mdns error",i)}async stop(){this.mdns!=null&&(this.mdns.removeListener("query",this._onMdnsQuery),this.mdns.removeListener("response",this._onMdnsResponse),this.mdns.removeListener("warning",this._onMdnsWarning),this.mdns.removeListener("error",this._onMdnsError),this._queryInterval!=null&&(clearInterval(this._queryInterval),this._queryInterval=null),await new Promise(i=>{this.mdns!=null?this.mdns.destroy(i):i()}),this.mdns=void 0)}}function tn(c={}){return i=>new en(i,c)}export{tn as mdns};
